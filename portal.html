<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interaktiv Kosmik Portal — Demo</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0f1724; --accent:#7ce4ff;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:radial-gradient(ellipse at center,var(--bg) 0%, #03040a 70%);color:#eaf6ff}
  .wrap{display:flex;gap:18px;max-width:1100px;margin:20px auto;padding:18px}
  .canvas-wrap{flex:1;position:relative;border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(2,6,23,0.7)}
  canvas{display:block;width:100%;height:70vh;background:transparent}
  .panel{width:320px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px}
  h1{font-size:18px;margin:6px 0 12px}
  .btn{display:inline-block;background:transparent;border:1px solid rgba(124,228,255,0.18);padding:8px 12px;border-radius:10px;color:var(--accent);cursor:pointer;margin:6px 6px 6px 0}
  .info{font-size:13px;color:#cfeefb88;margin-top:8px}
  .controls{display:flex;flex-wrap:wrap}
  .score{font-weight:700;font-size:22px;margin-top:8px;color:#7ef2ff}
  .small{font-size:12px;color:#bfefffaa}
  .footer{margin-top:12px;font-size:12px;color:#9edfff88}
  .orbit-btn{margin-top:10px}
  .game-title{font-size:15px;margin-top:8px}
  .center{display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="canvas-wrap">
    <canvas id="c"></canvas>
    <!-- HUD overlay -->
    <div style="position:absolute;left:12px;top:12px;color:#dff;backdrop-filter:blur(6px);padding:8px;border-radius:8px">
      <div class="small">Portal Mood: <span id="mood">Tinch</span></div>
      <div class="score">Score: <span id="score">0</span></div>
      <div class="small">Time: <span id="time">60</span>s</div>
    </div>
    <div style="position:absolute;right:12px;top:12px">
      <button class="btn" id="start">Start</button>
      <button class="btn" id="reset">Reset</button>
    </div>
  </div>

  <div class="panel">
    <h1>Interaktiv Kosmik Portal — Demo</h1>
    <div class="game-title">Mini-o‘yinlar</div>
    <div class="controls">
      <button class="btn" data-game="color" id="gcolor">Color-Melody</button>
      <button class="btn" data-game="time" id="gtime">Time-Orb</button>
      <button class="btn" data-game="pattern" id="gpattern">Pattern-Weave</button>
    </div>

    <div class="info" id="desc">
      Boshlash uchun <b>Start</b> bosing va o‘yinlardan birini tanlang. Klaviatura, sichqoncha va touch qo‘llab-quvvatlanadi.
    </div>

    <div class="footer">
      <div class="small">Kontroller: 1-4 ranglar uchun raqam tugmalar, orb uchun sichqoncha yoki tegish.</div>
      <div style="margin-top:8px"><button class="btn" id="mute">Mute</button></div>
    </div>
  </div>
</div>

<script>
/* Simple single-file interactive demo
   - Canvas rendering (stars, portal)
   - 3 mini-games with simple logic
   - WebAudio oscillator for tones
*/
const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
let W=innerWidth*0.65, H=innerHeight*0.75;
function resize(){ W = document.querySelector('.canvas-wrap').clientWidth; H = Math.max(360, window.innerHeight*0.68); canvas.width = Math.floor(W*devicePixelRatio); canvas.height = Math.floor(H*devicePixelRatio); canvas.style.width = W+'px'; canvas.style.height = H+'px'; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0); }
window.addEventListener('resize', resize); resize();

// simple starfield
const stars = Array.from({length:180}, ()=>({x:Math.random()*W,y:Math.random()*H,z:Math.random()*1.2+0.2,r:Math.random()*1.2+0.2}));
function drawStars(t){
  for(let s of stars){
    s.x -= 0.05 * (1 + s.z*2);
    if(s.x<0) s.x=W;
    ctx.beginPath(); ctx.globalAlpha = 0.6*s.z; ctx.fillStyle = `rgba(200,240,255,${0.6*s.z})`; ctx.arc(s.x,s.y,s.r*s.z,0,Math.PI*2); ctx.fill();
  }
}

// portal core
function drawPortal(t){
  const cx = W*0.5, cy = H*0.5;
  for(let i=12;i>0;i--){
    ctx.beginPath();
    const rad = 40 + i*18 + Math.sin(t/700+i)*6;
    ctx.strokeStyle = `rgba(60,120,180,${0.06*i})`;
    ctx.lineWidth = 6; ctx.arc(cx,cy,rad,0,Math.PI*2); ctx.stroke();
  }
  // center glow
  const g = ctx.createRadialGradient(cx,cy,10,cx,cy,140);
  g.addColorStop(0,'rgba(120,220,255,0.25)'); g.addColorStop(1,'rgba(10,10,20,0)');
  ctx.fillStyle = g; ctx.fillRect(cx-160,cy-160,320,320);
}

// simple UI pulses
let last = performance.now();
function clear(){ ctx.clearRect(0,0,W,H); }

// audio setup
let audioCtx = null, masterGain = null, muted=false;
function ensureAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  masterGain = audioCtx.createGain(); masterGain.connect(audioCtx.destination); masterGain.gain.value = 0.12;
}
function playTone(freq, time=0.18){
  if(muted) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sine'; o.frequency.value = freq; g.gain.value = 0;
  o.connect(g); g.connect(masterGain);
  o.start(); g.gain.linearRampToValueAtTime(1.0, audioCtx.currentTime+0.02); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+time);
  o.stop(audioCtx.currentTime+time+0.02);
}

// Game system
let game = null;
let score = 0, timeLeft = 60, running=false;
const moodEl = document.getElementById('mood'), scoreEl = document.getElementById('score'), timeEl = document.getElementById('time');
function setMood(m){
  moodEl.textContent = m;
  if(m==='Hayajon'){ document.documentElement.style.setProperty('--bg','#1a0215'); document.documentElement.style.setProperty('--accent','#ff9b7c'); }
  else { document.documentElement.style.setProperty('--bg','#0b1020'); document.documentElement.style.setProperty('--accent','#7ce4ff'); }
}
setMood('Tinch');

function updateHUD(){
  scoreEl.textContent = score;
  timeEl.textContent = Math.max(0, Math.floor(timeLeft));
}

// Start / Reset
document.getElementById('start').addEventListener('click', ()=>{
  if(!running){ running=true; timeLeft=60; score=0; last = performance.now(); if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }
});
document.getElementById('reset').addEventListener('click', ()=>{ running=false; score=0; timeLeft=60; game=null; updateHUD(); });

document.getElementById('mute').addEventListener('click', (e)=>{ muted = !muted; e.target.textContent = muted ? 'Unmute' : 'Mute'; if(masterGain) masterGain.gain.value = muted ? 0 : 0.12; });

// Game selectors
document.getElementById('gcolor').addEventListener('click', ()=>{ startGame('color'); });
document.getElementById('gtime').addEventListener('click', ()=>{ startGame('time'); });
document.getElementById('gpattern').addEventListener('click', ()=>{ startGame('pattern'); });

function startGame(name){
  if(!running) { alert('Iltimos, avval Start bosing.'); return; }
  if(name==='color') game = ColorMelody();
  if(name==='time') game = TimeOrb();
  if(name==='pattern') game = PatternWeave();
}

// Color-Melody
function ColorMelody(){
  const colors = ['#ff6b6b','#ffd166','#6be5ff','#8affc1'];
  let seq=[], idx=0, playing=false, allowInput=false, level=1;
  function genSeq(){ seq = Array.from({length:level+2}, ()=>Math.floor(Math.random()*4)); idx=0; }
  function playSeq(){
    playing=true; allowInput=false;
    let i=0;
    const tick = ()=>{ if(i>=seq.length){ playing=false; allowInput=true; return; } const c = seq[i]; playTone(220 + c*80, 0.25); flashColor(colors[c]); i++; setTimeout(tick, 450); }
    tick();
  }
  function flashColor(col){
    // small animation by setting a global overlay color
    overlayColor = col; overlayTimer = 0.26;
  }
  let overlayColor=null, overlayTimer=0;
  genSeq(); playSeq();
  return {
    step(dt){
      if(overlayTimer>0) overlayTimer -= dt;
      // draw color pads
      const size = 86, gap=14; const cx = W*0.5-((size*2+gap)/2);
      for(let i=0;i<4;i++){
        const r = 12;
        const x = cx + (i%2)*(size+gap);
        const y = H*0.6 + Math.floor(i/2)*(size+gap);
        ctx.beginPath(); ctx.fillStyle = colors[i]; ctx.roundRect(x,y,size,size,8); ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth=2; ctx.stroke();
      }
      if(overlayTimer>0){
        ctx.beginPath(); ctx.fillStyle = overlayColor+'33'; ctx.fillRect(0,0,W,H);
      }
    },
    onClick(x,y){
      const size = 86, gap=14; const cx = W*0.5-((size*2+gap)/2);
      for(let i=0;i<4;i++){
        const rx = cx + (i%2)*(size+gap);
        const ry = H*0.6 + Math.floor(i/2)*(size+gap);
        if(x>rx && x<rx+size && y>ry && y<ry+size){
          if(!allowInput) return;
          playTone(220 + i*80, 0.18);
          flashColor(['#ff6b6b','#ffd166','#6be5ff','#8affc1'][i]);
          // check correctness
          const expected = seq[idx];
          if(i===expected){ score += 10; idx++; if(idx>=seq.length){ level++; genSeq(); playSeq(); } } else { timeLeft -= 2; playTone(120,0.12); genSeq(); playSeq(); }
        }
      }
    }
  };
}

// Time-Orb
function TimeOrb(){
  const orbs = [];
  function spawn(){ const t = Math.random(); const type = t<0.7 ? 'normal' : (t<0.9 ? 'time' : 'minus'); orbs.push({x:Math.random()*(W-60)+30,y:Math.random()*(H-160)+80, vx:(Math.random()-0.5)*120, vy:(Math.random()-0.5)*80, r:12 + Math.random()*14, type}); }
  for(let i=0;i<7;i++) spawn();
  return {
    step(dt){
      // update + draw orbs
      for(let o of orbs){
        o.x += o.vx*dt; o.y += o.vy*dt;
        if(o.x<30||o.x>W-30) o.vx *= -1;
        if(o.y<60||o.y>H-40) o.vy *= -1;
        ctx.beginPath();
        if(o.type==='normal') ctx.fillStyle='rgba(140,220,255,0.95)';
        if(o.type==='time') ctx.fillStyle='rgba(190,255,170,0.95)';
        if(o.type==='minus') ctx.fillStyle='rgba(255,150,150,0.95)';
        ctx.arc(o.x,o.y,o.r,0,Math.PI*2); ctx.fill();
      }
    },
    onClick(x,y){
      for(let i=orbs.length-1;i>=0;i--){
        const o = orbs[i];
        const d = Math.hypot(x-o.x,y-o.y);
        if(d < o.r + 6){
          if(o.type==='normal'){ score += 5; playTone(320,0.12); }
          else if(o.type==='time'){ score += 7; timeLeft += 5; playTone(560,0.18); }
          else { score = Math.max(0, score-3); timeLeft = Math.max(0, timeLeft-5); playTone(140,0.18); }
          orbs.splice(i,1); if(Math.random()<0.6) spawn();
          break;
        }
      }
    }
  };
}

// Pattern-Weave
function PatternWeave(){
  let seq=[], idx=0, level=1, showing=false, allow=false;
  const palette = ['▲','◆','●','■','★','◯'];
  function gen(){ seq = Array.from({length:level+2}, ()=>Math.floor(Math.random()*Math.min(palette.length, level+2))); idx=0; showing=true; allow=false; let i=0; const tick=()=>{
    if(i>=seq.length){ showing=false; allow=true; return; }
    flashSym(palette[seq[i]]); playTone(240 + seq[i]*60, 0.18); i++; setTimeout(tick, 520);
  }; tick();}
  let currentFlash = null, flashT=0;
  function flashSym(sym){ currentFlash = {sym}; flashT = 0.36; }
  gen();
  return {
    step(dt){
      // draw current pattern area
      const cx = W*0.5, cy = H*0.55;
      ctx.font = '26px system-ui';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      const spacing = 48;
      for(let i=0;i<seq.length;i++){
        ctx.beginPath();
        ctx.fillStyle = (i===idx && allow)? 'rgba(255,255,255,0.14)' : 'rgba(255,255,255,0.06)';
        ctx.roundRect(cx - (seq.length*spacing)/2 + i*spacing -18, cy-28, 36,56,8); ctx.fill();
        ctx.fillStyle='#eaf6ff';
        ctx.fillText(palette[seq[i]], cx - (seq.length*spacing)/2 + i*spacing, cy);
      }
      if(flashT>0) { flashT -= dt; ctx.fillStyle='rgba(160,220,255,0.18)'; ctx.fillRect(0,cy-60,W,120); }
    },
    onClick(x,y){
      if(!allow) return;
      // detect which box clicked
      const cx = W*0.5, cy = H*0.55;
      const spacing = 48;
      for(let i=0;i<seq.length;i++){
        const rx = cx - (seq.length*spacing)/2 + i*spacing -18;
        if(x>rx && x<rx+36 && y>cy-28 && y<cy+28){
          playTone(300 + i*40,0.12);
          if(i===seq[idx]){ score += 15; idx++; if(idx>=seq.length){ level++; gen(); } }
          else { timeLeft -= 4; gen(); }
          break;
        }
      }
    }
  };
}

// helpers: roundRect
CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r){
  if (w < 0) { x = x + w; w = -w; }
  if (h < 0) { y = y + h; h = -h; }
  this.beginPath();
  this.moveTo(x + r, y);
  this.arcTo(x + w, y, x + w, y + h, r);
  this.arcTo(x + w, y + h, x, y + h, r);
  this.arcTo(x, y + h, x, y, r);
  this.arcTo(x, y, x + w, y, r);
  this.closePath();
  return this;
};

// interactions
canvas.addEventListener('click', e=>{
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX - rect.left), y = (e.clientY - rect.top);
  if(game && game.onClick) game.onClick(x,y);
});
canvas.addEventListener('touchstart', e=>{
  const rect = canvas.getBoundingClientRect();
  const t = e.touches[0]; const x = (t.clientX - rect.left), y = (t.clientY - rect.top);
  if(game && game.onClick) game.onClick(x,y);
  e.preventDefault();
});

// animation loop
let overlayColor=null, overlayTimer=0;
function loop(now){
  const dt = Math.min(0.06, (now - last)/1000); last = now;
  if(running) timeLeft -= dt;
  clear();
  drawStars(now);
  drawPortal(now);
  if(game && game.step) game.step(dt);
  // portal vibe overlay
  if(overlayTimer>0) { ctx.fillStyle = overlayColor+'33'; ctx.fillRect(0,0,W,H); overlayTimer -= dt; }
  // HUD glow
  ctx.beginPath(); ctx.fillStyle = 'rgba(20,40,60,0.06)'; ctx.fillRect(0,H-80,W,80);
  updateHUD();
  if(running && timeLeft<=0){ running=false; alert('Vaqt tugadi! Yakuniy ball: ' + score + '\\nYulduzlar: ' + (score>=120?3:(score>=50?2:1))); }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// keyboard shortcuts for color-melody
window.addEventListener('keydown', (e)=>{
  if(e.key>='1' && e.key<='4'){ const k = Number(e.key)-1;
    if(game && game.onClick){
      // map number to approximate cell position for color game
      const size = 86, gap=14; const cx = W*0.5-((size*2+gap)/2);
      const x = cx + (k%2)*(size+gap) + size/2;
      const y = H*0.6 + Math.floor(k/2)*(size+gap) + size/2;
      game.onClick(x,y);
    }
  }
});

// touch to resume audio if needed
document.body.addEventListener('pointerdown', ()=>{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); });

// small initial mood randomizer
setMood(Math.random()>0.5 ? 'Hayajon' : 'Tinch');
</script>
</body>
</html>